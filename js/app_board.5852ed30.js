(self["webpackChunkjdrave_app"]=self["webpackChunkjdrave_app"]||[]).push([[253],{8361:function(e,a,t){"use strict";t.d(a,{Z:function(){return o}});var i=t(6252),l=t(3577);const s={width:"79",height:"83",viewBox:"0 0 79 83",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n={"xml:space":"preserve",class:"text-2xl fill-current font-secondary font-bold whitespace-pre"},r={x:"25.6979",y:"48.8472"},c=(0,i._)("path",{d:"M39.9051 1.09177L63.3552 8.7335M39.9051 1.09177L16.455 8.7335M39.9051 1.09177L39.9051 9.89455M63.3552 8.7335L77.8481 28.7398M63.3552 8.7335L57.9246 16.2966M77.8481 28.7398V53.469M77.8481 28.7398L69.0613 31.5971M77.8481 53.469L63.3552 73.4753M77.8481 53.469L69.0613 50.6118M63.3552 73.4753L39.9051 81.1171M63.3552 73.4753L57.9246 65.9123M39.9051 81.1171L16.455 73.4753M39.9051 81.1171V72.3143M16.455 73.4753L1.96204 53.469M16.455 73.4753L21.8855 65.9123M1.96204 53.469L1.96204 28.7398M1.96204 53.469L10.7488 50.6118M1.96204 28.7398L16.455 8.7335M1.96204 28.7398L10.73 31.5971M16.455 8.7335L21.8855 16.2966M39.9051 72.3143L10.7488 50.6118M39.9051 72.3143L69.0613 50.6118M10.7488 50.6118L21.8855 16.2966M21.8855 16.2966L57.9246 16.2966M57.9246 16.2966L69.0613 50.6118M39.9051 9.89455L10.7488 31.5971L21.8855 65.9123M39.9051 9.89455L69.0613 31.5971M21.8855 65.9123H57.9246M57.9246 65.9123L69.0613 31.5971",class:"stroke-current stroke-2"},null,-1);var u=(0,i.aZ)({props:{result:null},setup(e){return(a,t)=>((0,i.wg)(),(0,i.iD)("svg",s,[(0,i._)("text",n,[(0,i._)("tspan",r,(0,l.zw)(e.result),1)]),c]))}});const d=u;var o=d},2684:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return de}});var i=t(6252),l=t(2262),s=t(3577),n=t(9963),r=t(3324);const c={class:"p-2 pb-10 rounded-t-md bg-white shadow-md overflow-y-auto"},u={class:"flex justify-between"},d={class:"font-semibold"},o={class:"mt-4"},m=(0,i._)("p",{class:"font-semibold"},"Stats",-1),v={key:0,class:"border border-gray-200 rounded-md flex max-w-fit"},p=["onClick"],k={class:"uppercase font-semibold"},f={key:1,class:"border border-gray-200 rounded-md max-w-fit mt-3"},g=["onClick"],h={class:"py-1 px-2 font-semibold"},w={class:"py-1 px-2 border-l border-gray-200"},b={class:"mt-4"},y=(0,i._)("p",{class:"font-semibold"},"Équipement",-1),_={class:"whitespace-pre-wrap"},S={class:"mt-4"},x=(0,i._)("p",{class:"font-semibold"},"Inventaire",-1),D={class:"whitespace-pre-wrap"};var N=(0,i.aZ)({props:{character:null,selectedStat:null},emits:["select-stat"],setup(e,{emit:a}){const t=e,{t:n}=(0,r.QT)(),N=(0,i.Fl)((()=>Object.keys(t.character.features.features).sort(((e,a)=>n(`features.${e}`).localeCompare(n(`features.${a}`)))).map((e=>({key:e,value:t.character.features.features[e]}))))),M=e=>{a("select-stat",e)};return(a,t)=>((0,i.wg)(),(0,i.iD)("div",c,[(0,i._)("div",u,[(0,i._)("p",d,(0,s.zw)(e.character.name),1),(0,i._)("p",null,"PV : "+(0,s.zw)(e.character.currentHp)+"/"+(0,s.zw)(e.character.maxHp),1)]),(0,i._)("div",o,[m,e.character.features?.stats?((0,i.wg)(),(0,i.iD)("ul",v,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.character.features.stats,((a,t,l)=>((0,i.wg)(),(0,i.iD)("li",{key:t,class:(0,s.C_)(["py-1 px-2 cursor-pointer",{"border-l border-gray-200":0!==l,"bg-secondary":e.selectedStat?.name===t}]),onClick:e=>M({name:t,value:a})},[(0,i._)("p",k,(0,s.zw)(t),1),(0,i._)("p",null,(0,s.zw)(a),1)],10,p)))),128))])):(0,i.kq)("",!0),e.character.features?.features?((0,i.wg)(),(0,i.iD)("ul",f,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)((0,l.SU)(N),(({key:t,value:l},n)=>((0,i.wg)(),(0,i.iD)("li",{key:t,class:(0,s.C_)(["flex justify-between cursor-pointer",{"border-t border-gray-200":0!==n,"bg-secondary":e.selectedStat?.name===t}]),onClick:e=>M({name:t,value:l})},[(0,i._)("p",h,(0,s.zw)(a.$t(`features.${t}`)),1),(0,i._)("p",w,(0,s.zw)(l),1)],10,g)))),128))])):(0,i.kq)("",!0)]),(0,i._)("div",b,[y,(0,i._)("p",_,(0,s.zw)(e.character.equipment),1)]),(0,i._)("div",S,[x,(0,i._)("p",D,(0,s.zw)(e.character.inventory),1)])]))}});const M=N;var C=M;const R={class:"flex justify-between"},L={class:"font-semibold"};var F=(0,i.aZ)({props:{character:null,isSelected:{type:Boolean}},setup(e){return(a,t)=>((0,i.wg)(),(0,i.iD)("div",{class:(0,s.C_)(["p-2 rounded-md transition-all cursor-pointer shadow-md",{"bg-white hover:bg-gray-100":!e.isSelected,"bg-primary text-white hover:bg-primary-hover":e.isSelected}])},[(0,i._)("div",R,[(0,i._)("p",L,(0,s.zw)(e.character.name),1),(0,i._)("p",null,"PV : "+(0,s.zw)(e.character.currentHp)+"/"+(0,s.zw)(e.character.maxHp),1)])],2))}});const z=F;var H=z,q=t(8361);function j(e,a){return(0,i.wg)(),(0,i.j4)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[(0,i.Wm)("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])}function I(e,a){return(0,i.wg)(),(0,i.j4)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[(0,i.Wm)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})])}var V=t(7102),$=t(120),O=t(75),U=t.n(O);const B={key:0},K={key:1,class:"grid--board grid p-2 pb-0 gap-x-2 flex-1"},W={class:"sidebar__players"},E=["onClick"],Y={class:"grid grid-cols-3 gap-x-2"},Z={key:1,class:"self-center bg-primary text-white relative px-4 py-6 rounded-md"},G={key:0,class:"absolute -top-4 left-1/2 -translate-x-1/2 z-1"},T={class:"absolute bg-white top-full left-1/2 -translate-x-1/2 mt-2 z-2 shadow-lg rounded overflow-hidden min-w-[170px] text-dark"},P=["onClick"],A={class:"grid grid-cols-2 gap-x-2 mt-4"},Q={class:"font-semibold"},J={class:"text-center mt-4"},X=(0,i.Uk)("Test"),ee={key:1,class:"mt-4"},ae={key:0},te={key:1},ie={key:2},le={class:"sidebar__npcs"},se=["onClick"];var ne;(function(e){e["Simple"]="simple",e["Dramatic"]="dramatic",e["Opposed"]="opposed",e["OpposedMelee"]="opposed_melee"})(ne||(ne={}));var re=(0,i.aZ)({props:{gameId:null},setup(e){const a=e,{result:t,loading:r}=(0,V.aM)(U(),(()=>({gameId:a.gameId}))),c=(0,i.Fl)((()=>t.value?.characters??[])),u=(0,i.Fl)((()=>t.value?.game)),d=(0,i.Fl)((()=>c.value.filter((({isNpc:e})=>!e)))),o=(0,i.Fl)((()=>c.value.filter((({isNpc:e})=>e)))),m=(0,l.iH)([]),v=e=>{const a=m.value.findIndex((({character:{id:a}})=>e.id===a));a>=0?m.value.splice(a,1):m.value.push({character:e,stat:null,dieResult:null})},p=e=>m.value.some((({character:{id:a}})=>a===e)),{shift:k,ctrl:f,z:g}=(0,$.IKb)();(0,i.m0)((()=>{k.value&&f.value&&g.value&&(m.value=[])}));const h=()=>{m.value.reverse()},w=(0,l.iH)(ne.Simple),b=(0,i.Fl)((()=>Object.values(ne).filter((e=>e!==w.value)))),y=(0,l.iH)(!1),_=e=>{w.value=e,y.value=!1},S=(0,l.iH)(null);(0,$.i9H)(S,(()=>y.value=!1));const x=(e,a)=>{const t=m.value[a].stat;if(t){const i=t.name===e.name&&t.value===e.value;i?(m.value[a].stat=null,m.value[a].dieResult=null):(m.value[a].stat=e,m.value[a].dieResult=0)}else m.value[a].stat=e,m.value[a].dieResult=0},D=(e,a)=>{const t=m.value[e].dieResult;if(t){const e=String(t).split(""),i=t>=11&&(100===t||e[0]===e[1]),l=a.value-t<0,s=Math.floor(a.value/10)-Math.floor(t/10),n=l&&0===s?-0:s;return{SR:n,isCritical:i,isNegative:l,diff:s}}throw"missing dice result"},N=()=>{const e=m.value[0].stat;if(e){const{isCritical:a}=D(0,e),t=!!m.value[0].dieResult&&m.value[0].dieResult<=e.value;return{isCritical:a,isSuccessful:t}}throw"missing selected stat"},M=()=>{const e=m.value[0].stat;if(e){const{isCritical:a,SR:t}=D(0,e),i=!!m.value[0].dieResult&&m.value[0].dieResult<=e.value;return{isCritical:a,isSuccessful:i,DR:t}}throw"missing selected stat"},R=()=>{const e=m.value.map((({stat:e},a)=>{if(e){const{SR:t,isCritical:i}=D(a,e);return{SR:t,isCritical:i}}throw"missing selected stat for both character"})),a=e[0].SR>e[1].SR,t=Math.abs(e[0].SR-e[1].SR);return{isCritical:e[0].isCritical,isSuccessful:a,DR:t}},L=()=>{const e=m.value.map((({stat:e},a)=>{if(e){const{SR:t,isCritical:i}=D(a,e);return{SR:t,isCritical:i}}throw"missing selected stat for both character"})),a=e[0].SR>e[1].SR,t=Math.abs(e[0].SR-e[1].SR);let i=0,l=0;if(a){const e=Math.floor(Number(Object.entries(m.value[0].character.features.stats).find((([e])=>"f"===e))?.[1]??0)/10);i=t+e;const a=Math.floor(Number(Object.entries(m.value[1].character.features.stats).find((([e])=>"e"===e))?.[1]??0)/10);l=i-a,l<1&&(l=1)}return{DR:t,isCritical:e[0].isCritical,isSuccessful:a,damages:i,lostHp:l}},F=(0,l.iH)(),z=()=>{try{let e;switch(w.value){case ne.Simple:e=N();break;case ne.Dramatic:e=M();break;case ne.Opposed:e=R();break;case ne.OpposedMelee:e=L();break}F.value=e}catch(e){console.error(e)}},O=e=>{m.value[e].dieResult=Math.floor(100*Math.random()+1)};return(e,a)=>{const t=(0,i.up)("BaseButton"),c=(0,i.up)("BaseInput");return(0,l.SU)(r)?((0,i.wg)(),(0,i.iD)("p",B,"Characters are loading")):(0,l.SU)(u)?((0,i.wg)(),(0,i.iD)("div",K,[(0,i._)("div",W,[(0,i._)("ul",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)((0,l.SU)(d),(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.id,class:"mb-2",onClick:a=>v(e)},[(0,i.Wm)(H,{character:e,"is-selected":p(e.id)},null,8,["character","is-selected"])],8,E)))),128))])]),(0,i._)("div",Y,[m.value[0]?((0,i.wg)(),(0,i.j4)(C,{key:m.value[0].character.id,character:m.value[0].character,"selected-stat":m.value[0].stat,class:"character-item",onSelectStat:a[0]||(a[0]=e=>x(e,0))},null,8,["character","selected-stat"])):(0,i.kq)("",!0),m.value.length>0?((0,i.wg)(),(0,i.iD)("div",Z,[m.value.length>1?((0,i.wg)(),(0,i.iD)("div",G,[(0,i.Wm)(t,{class:"tertiary icon shadow-lg",onClick:h},{default:(0,i.w5)((()=>[(0,i.Wm)((0,l.SU)(I),{class:"w-6 h-6"})])),_:1})])):(0,i.kq)("",!0),(0,i._)("div",{class:"relative",ref_key:"testKindSelectorRef",ref:S},[(0,i._)("p",{class:"flex items-center gap-x-1 cursor-pointer",onClick:a[1]||(a[1]=e=>y.value=!y.value)},[(0,i.Uk)((0,s.zw)(e.$t(`test_kind.${w.value}`))+" ",1),(0,i.Wm)((0,l.SU)(j),{class:"w-4 h-4"})]),(0,i.wy)((0,i._)("ul",T,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)((0,l.SU)(b),(a=>((0,i.wg)(),(0,i.iD)("li",{key:a,class:"p-2 hover:bg-tertiary cursor-pointer",onClick:e=>_(a)},(0,s.zw)(e.$t(`test_kind.${a}`)),9,P)))),128))],512),[[n.F8,y.value]])],512),(0,i._)("div",A,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(m.value,(({stat:a},t)=>((0,i.wg)(),(0,i.iD)("div",{key:t,class:"flex gap-x-1"},[a?((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[(0,i._)("span",Q,(0,s.zw)(e.$t(`features.${a.name}`)),1),(0,i._)("span",null,(0,s.zw)(a.value),1)],64)):(0,i.kq)("",!0)])))),128)),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(m.value,(({stat:e},a)=>((0,i.wg)(),(0,i.iD)("div",{key:a},[e?((0,i.wg)(),(0,i.j4)(c,{key:0,modelValue:m.value[a].dieResult,"onUpdate:modelValue":e=>m.value[a].dieResult=e,type:"number",onRightLabelClick:e=>O(a)},{"right-label":(0,i.w5)((()=>[(0,i.Wm)(q.Z,{class:"w-7 h-7",result:"100"})])),_:2},1032,["modelValue","onUpdate:modelValue","onRightLabelClick"])):(0,i.kq)("",!0)])))),128))]),(0,i._)("div",J,[(0,i.Wm)(t,{onClick:z},{default:(0,i.w5)((()=>[X])),_:1})]),F.value?((0,i.wg)(),(0,i.iD)("div",ee,[(0,i._)("ul",null,[(0,i._)("li",null,(0,s.zw)(F.value.isSuccessful?e.$t("success"):e.$t("fail"))+" "+(0,s.zw)(F.value.isCritical?e.$t("critical"):""),1),F.value.DR?((0,i.wg)(),(0,i.iD)("li",ae," Degré de réussite : "+(0,s.zw)(F.value.DR),1)):(0,i.kq)("",!0),F.value.damages?((0,i.wg)(),(0,i.iD)("li",te," Dommages causés : "+(0,s.zw)(F.value.damages),1)):(0,i.kq)("",!0),F.value.lostHp?((0,i.wg)(),(0,i.iD)("li",ie," PV perdus : "+(0,s.zw)(F.value.lostHp),1)):(0,i.kq)("",!0)])])):(0,i.kq)("",!0)])):(0,i.kq)("",!0),m.value[1]?((0,i.wg)(),(0,i.j4)(C,{key:m.value[1].character.id,character:m.value[1].character,"selected-stat":m.value[1].stat,class:"character-item",onSelectStat:a[2]||(a[2]=e=>x(e,1))},null,8,["character","selected-stat"])):(0,i.kq)("",!0)]),(0,i._)("div",le,[(0,i._)("ul",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)((0,l.SU)(o),(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.id,class:"mb-2",onClick:a=>v(e)},[(0,i.Wm)(H,{character:e,"is-selected":p(e.id)},null,8,["character","is-selected"])],8,se)))),128))])])])):(0,i.kq)("",!0)}}}),ce=t(8118);const ue=(0,ce.Z)(re,[["__scopeId","data-v-1ab3537a"]]);var de=ue},75:function(e){var a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"getGameBoard"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"gameId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"uuid"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"game"},name:{kind:"Name",value:"games_by_pk"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"gameId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dungeon_master"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"username"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"characters"},arguments:[{kind:"Argument",name:{kind:"Name",value:"where"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"game_id"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"_eq"},value:{kind:"Variable",name:{kind:"Name",value:"gameId"}}}]}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"features"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"maxHp"},name:{kind:"Name",value:"max_hp"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"currentHp"},name:{kind:"Name",value:"current_hp"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"picture"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"isNpc"},name:{kind:"Name",value:"is_npc"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"inventory"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"equipment"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"playerId"},name:{kind:"Name",value:"player_id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:364}};a.loc.source={body:"query getGameBoard($gameId: uuid!) {\n  game: games_by_pk(id: $gameId) {\n    id\n    title\n    dungeon_master {\n      id\n      username\n    }\n  }\n  characters(where: {game_id: {_eq: $gameId}}) {\n    id\n    name\n    features\n    maxHp: max_hp\n    currentHp: current_hp\n    picture\n    isNpc: is_npc\n    inventory\n    equipment\n    playerId: player_id\n    status\n  }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function t(e,a){if("FragmentSpread"===e.kind)a.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&a.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){t(e,a)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){t(e,a)})),e.definitions&&e.definitions.forEach((function(e){t(e,a)}))}var i={};function l(e,a){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==a)return i}}function s(e,a){var t={kind:e.kind,definitions:[l(e,a)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var s=i[a]||new Set,n=new Set,r=new Set;s.forEach((function(e){r.add(e)}));while(r.size>0){var c=r;r=new Set,c.forEach((function(e){if(!n.has(e)){n.add(e);var a=i[e]||new Set;a.forEach((function(e){r.add(e)}))}}))}return n.forEach((function(a){var i=l(e,a);i&&t.definitions.push(i)})),t}(function(){a.definitions.forEach((function(e){if(e.name){var a=new Set;t(e,a),i[e.name.value]=a}}))})(),e.exports=a,e.exports.getGameBoard=s(a,"getGameBoard")}}]);
//# sourceMappingURL=app_board.5852ed30.js.map